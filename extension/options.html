<!DOCTYPE html>
<html>
<head>
  <title>Download Router - Settings</title>
  <link rel="stylesheet" href="options.css">
  <script src="lib/icons.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="app-container">
      <div class="header-content">
        <div class="app-icon" id="options-app-icon"></div>
        <div class="app-title">
          <h1>Download Router Settings</h1>
          <p class="app-subtitle">Configure your download routing rules</p>
        </div>
      </div>
      <nav class="tab-navigation">
        <button class="tab-btn active" data-tab="rules">Rules</button>
        <button class="tab-btn" data-tab="filetypes">File Types</button>
        <button class="tab-btn" data-tab="settings">Settings</button>
      </nav>
    </div>
  </header>

  <div class="app-wrapper">
    <main class="app-main">
      <!-- Rules Tab -->
      <div class="tab-content active" id="rules-tab">
        <div class="section-header">
          <h2>Download Rules</h2>
          <p class="section-description">Create rules to automatically route downloads to specific folders</p>
        </div>
        
        <div class="rules-container" id="rules-container">
          <div class="empty-state" id="rules-empty">
            <div class="empty-icon" id="rules-empty-icon"></div>
            <h3>No rules configured</h3>
            <p>Create your first rule to start organizing downloads automatically</p>
          </div>
        </div>
        
        <div class="section-actions">
          <button class="btn primary" id="add-rule">
            <span class="btn-icon" id="add-rule-icon"></span>
            Add Rule
          </button>
        </div>
      </div>

      <!-- File Types Tab -->
      <div class="tab-content" id="filetypes-tab">
        <div class="section-header">
          <h2>File Types</h2>
          <p class="section-description">Organize file types into groups for easier management</p>
        </div>
        
        <div class="groups-container" id="groups-container">
          <div class="empty-state" id="groups-empty">
            <div class="empty-icon" id="groups-empty-icon"></div>
            <h3>No file types configured</h3>
            <p>Create file types to organize similar file extensions together</p>
          </div>
        </div>
        
        <div class="section-actions">
          <button class="btn primary" id="add-group">
            <span class="btn-icon" id="add-group-icon"></span>
            Add File Type
          </button>
          <button class="btn secondary" id="load-defaults">
            <span class="btn-icon" id="load-defaults-icon"></span>
            Load Default File Types
          </button>
        </div>
      </div>

      <!-- Settings Tab -->
      <div class="tab-content" id="settings-tab">
        <div class="section-header">
          <h2>General Settings</h2>
          <p class="section-description">Configure how Download Router behaves</p>
        </div>
        
        <div class="settings-grid">
          <div class="setting-card">
            <div class="setting-header">
              <h3>Confirmation Overlay</h3>
              <label class="toggle-switch">
                <input type="checkbox" id="confirmation-enabled" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <p class="setting-description">Show a confirmation overlay before saving downloads</p>
            
            <div class="setting-option" id="timeout-setting">
              <label for="confirmation-timeout">Auto-save timeout (seconds):</label>
              <input type="range" id="confirmation-timeout" min="1" max="17" value="5" class="range-input">
              <span class="range-value" id="timeout-value">5s</span>
            </div>
            <div class="setting-warning" style="margin-top: 8px; padding: 8px 12px; background: #fff3e0; border: 1px solid #ff9800; border-radius: 4px; font-size: 12px; color: #e65100;">
              <strong>Chrome Limitation:</strong> The timer may not always work reliably due to Chrome's download handling. Downloads may proceed before the timeout in some cases.
              <span id="companion-app-timer-note" style="display: none; margin-top: 4px; display: block;">
                <strong>Tip:</strong> With the companion app installed, files can still be moved after download completes.
              </span>
            </div>
          </div>

          <div class="setting-card">
            <div class="setting-header">
              <h3>Default Folder</h3>
            </div>
            <p class="setting-description">Where to save downloads when no rules match</p>
            
            <div id="default-folder-companion-info" style="display: none; margin-bottom: 12px; padding: 8px 12px; background: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px; font-size: 12px; color: #2e7d32;">
              <strong>âœ“ Companion App Installed:</strong> You can select any folder on your system using the Browse button below.
            </div>
            
            <div id="default-folder-non-companion-info" style="display: none; margin-bottom: 12px; padding: 8px 12px; background: #fff3e0; border: 1px solid #ff9800; border-radius: 4px; font-size: 12px; color: #e65100;">
              <strong>Chrome Limitation:</strong> Without the companion app, this extension cannot change Chrome's base download directory. 
              You can only specify subdirectories relative to Chrome's download folder (e.g., "Documents", "Videos/2024").
              <br><br>
              <strong>To change Chrome's base download directory:</strong> Use the button below to open Chrome's download settings.
            </div>
            
            <div class="setting-input">
              <input type="text" id="default-folder" value="Downloads" class="form-input" placeholder="Downloads">
              <button id="browse-default-folder" class="btn secondary">Browse</button>
            </div>
            
            <div id="chrome-downloads-link" style="margin-top: 8px; display: none;">
              <button id="open-chrome-downloads-settings" class="btn secondary" style="font-size: 12px; padding: 6px 12px;">
                Open Chrome Download Settings
              </button>
              <p style="font-size: 11px; color: #6e6e73; margin-top: 4px;">
                Change Chrome's default download location in Chrome settings
              </p>
            </div>
          </div>

          <div class="setting-card">
            <div class="setting-header">
              <h3>Conflict Resolution</h3>
            </div>
            <p class="setting-description">When multiple rules have the same priority:</p>
            
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="conflict-resolution" value="auto" checked>
                <span class="radio-custom"></span>
                <div class="radio-content">
                  <strong>Auto-resolve</strong>
                  <small>Use highest priority rule automatically</small>
                </div>
              </label>
              <label class="radio-option">
                <input type="radio" name="conflict-resolution" value="ask">
                <span class="radio-custom"></span>
                <div class="radio-content">
                  <strong>Ask Every Time</strong>
                  <small>Show conflict dialog in overlay</small>
                </div>
              </label>
            </div>
          </div>

          <div class="setting-card">
            <div class="setting-header">
              <h3>Save As Dialog</h3>
            </div>
            <p class="setting-description">
              The extension cannot detect if Chrome's "Ask where to save each file before downloading" setting is enabled.
              If this setting is on, Chrome's Save As dialog will appear, and the extension's routing may not apply as expected.
            </p>
            <div style="margin-top: 8px;">
              <button id="open-chrome-download-behavior" class="btn secondary" style="font-size: 12px; padding: 6px 12px;">
                Check Chrome Download Behavior Settings
              </button>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <footer class="app-footer">
    <div class="app-container">
      <div class="footer-actions">
          <button class="btn secondary" id="reset-options">
            <span class="btn-icon" id="reset-options-icon"></span>
            Reset to Defaults
          </button>
      </div>
      <div class="status-message" id="status"></div>
    </div>
  </footer>

  <!-- Modals -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="folder-picker-modal">
      <div class="modal-header">
        <h3>Choose Folder</h3>
        <button class="modal-close" id="close-modal">X</button>
      </div>
      <div class="modal-body">
        <div class="folder-tree" id="folder-tree"></div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" id="modal-cancel">Cancel</button>
        <button class="btn primary" id="modal-select">Select Folder</button>
      </div>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html>
